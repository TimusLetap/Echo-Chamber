import sqlite3

def init_db():
    """
    This is the function that CREATES the 'reflection.db' file if it doesn't exist.
    It then connects to it and creates the 'interactions' table inside it.
    """
    # This line creates the file 'data/reflection.db' automatically.
    conn = sqlite3.connect('data/reflection.db') 
    cursor = conn.cursor()
    
    # This is the "schema" or structure for our data inside the database.
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS interactions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            session_id TEXT NOT NULL,
            turn INTEGER NOT NULL,
            sender TEXT NOT NULL,
            message TEXT NOT NULL,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    conn.commit()
    conn.close()
    print("Database 'reflection.db' initialized successfully.")

def log_interaction(session_id, turn, sender, message):
    """
    This function connects to the database and adds a new row of data.
    """
    conn = sqlite3.connect('data/reflection.db')
    cursor = conn.cursor()
    cursor.execute(
        "INSERT INTO interactions (session_id, turn, sender, message) VALUES (?, ?, ?, ?)",
        (session_id, turn, sender, message)
    )
    conn.commit()
    conn.close()

# To run this file directly and create the database for the first time:
if __name__ == '__main__':
    init_db()

